{% extends "map/layout.html" %}
{% load static %}

{% block script %}
<script src="{% static 'search.js' %}"></script>
<script>
    window.isUserAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};
    window.loginUrl = "{% url 'login' %}"; 

    function bookmarkOrgan(organId, linkElement) {
        if (!window.isUserAuthenticated) {
            window.location.href = window.loginUrl;
            return;
        }

        $.ajax({
            url: '/api/bookmark',
            method: 'GET',
            data: { organ_id: organId },
            success: function(response) {
                if (response.message === 'Bookmark added') {
                    linkElement.html('★ Saved');
                    linkElement.addClass('bookmarked');
                } else if (response.message === 'Bookmark removed') {
                    linkElement.html('☆ Save organ to your list');
                    linkElement.removeClass('bookmarked');
                }
            },
            error: function(xhr, status, error) {
                console.error("Error bookmarking organ:", xhr.responseJSON ? xhr.responseJSON.error : error);
                alert("There was an error saving the bookmark. Please try again.");
            }
        });
    }
</script>
{% endblock %}

{% block content %}
<h1 class="mt-5 mb-3">Australian Organs</h1>
<div class="row">
    <div class="col-md-12">
        <p>Search for an organ in Australia:</p>
    </div>
</div>
<div class="row">
    <div class="col-8 col-md-10">
        <div class="form-group">
            <input type="text" class="form-control" name="q" id="q" autofocus>
        </div>
    </div>
    <div class="col-4 col-md-2">
        <div class="form-group">
            <button class="btn btn-primary" id="search">Search</button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12 mt-3">
        <div id="results"></div>
    </div>
</div>
<div id="loading" class="text-center" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>
{% endblock %}
